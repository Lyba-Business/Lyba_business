import React, { useState, useEffect } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query } from 'firebase/firestore';
importer {
  Wi-Fi, Zap, Utilisateurs, CheckCircle2, Menu, X, Téléphone, Courriel,
  MessageSquare, LayoutDashboard, Clock, ChevronRight,
  Vérification du bouclier, Globe, Verrouillage, Flèche haut droite, Processeur
} de 'lucide-react';

// Configuration Firebase
const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'lyba-business-premium';

const App = () => {
  const [utilisateur, setUser] = useState(null);
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [selectedPlan, setSelectedPlan] = useState(null);
  const [formStatus, setFormStatus] = useState({ type: '', message: '' });
  const [commandes, setCommandes] = utiliserÉtat([]);
  const [showAdmin, setShowAdmin] = useState(false);
  const [adminPass, setAdminPass] = useState('');
  const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);

  const contactData = {
    Courriel : « Lyba_business@yahoo.com »,
    téléphones : ["+243 992622205", "+243 901417627"]
  };

  const plans = [
    {
      id : 'début',
      prix : 49,
      vitesse : « 10 Mbps »,
      étiquette : « Business Basic »,
      desc: 'Parfait pour les entrepreneurs individuels et petits bureaux.'
    },
    {
      id : 'pro',
      prix : '62',
      vitesse : « 20 Mbps »,
      étiquette : « Élite des affaires »,
      populaire : vrai,
      desc: 'Le standard pour les PME nécessitant une stabilité totale.'
    },
    {
      id : 'ultra',
      prix : '70',
      vitesse : « 30 Mbps »,
      étiquette : « Corporate Ultra »,
      desc: 'Performance maximale pour les flux intensifs et le cloud.'
    }
  ];

  utiliserEffect(() => {
    signInAnonymously(auth).catch(err => console.error("Erreur d'authentification", err));
    const unsubscribeAuth = onAuthStateChanged(auth, setUser);
    return () => unsubscribeAuth();
  }, []);

  utiliserEffect(() => {
    si (!utilisateur || !estAdministrateurAuthentifié) retourner;
    const ordersCol = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
    const unsubscribeOrders = onSnapshot(ordersCol, (snapshot) => {
      const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      setOrders(data.sort((a, b) => (b.date?.seconds || 0) - (a.date?.seconds || 0)));
    }, (err) => console.error("Erreur Firestore", err));
    return () => unsubscribeOrders();
  }, [utilisateur, estAuthentifiéAdmin]);

  const handleOrder = async (e) => {
    e.prévenirDefault();
    si (!plan sélectionné) {
      setFormStatus({ type: 'error', message: 'Veuillez sélectionner un forfait.' });
      retour;
    }
    setFormStatus({ type : 'loading', message : 'Traitement sécurisé...' });
    
    essayer {
      const ordersCol = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
      attendre addDoc(ordersCol, {
        client : e.target.name.value,
        contact : e.target.phone.value,
        forfait: selectedPlan.label,
        montant : prix du plan sélectionné,
        date : serverTimestamp(),
        statut : 'Nouveau'
      });
      setFormStatus({ type: 'success', message: 'Votre demande a été inscrite avec succès.' });
      e.target.reset();
      setTimeout(() => setFormStatus({ type: '', message: '' }), 5000);
    } attraper (erreur) {
      setFormStatus({ type: 'error', message: 'échec de la connexion. Vérifiez votre réseau.' });
    }
  };

  const checkAdmin = () => {
    si (adminPass === 'LYBA2024') setIsAdminAuthenticated(true);
    sinon alert('Code d\'accÃ¨s invalide');
  };

  retour (
    <div className="min-h-screen bg-[#050505] text-white font-light selection:bg-[#D4AF37]/30">
      
      {/* EN-TÊTE PREMIUM */}
      <nav className="fixed top-0 w-full z-50 bg-black/80 backdrop-blur-xl border-b border-white/5 px-6 lg:px-12 h-20 flex items-center justify-between">
        <div className="flex items-center gap-4">
          <div className="h-10 w-10 bg-gradient-to-br from-[#D4AF37] to-[#8E7618] rounded-sm flex items-center justify-center rotate-45 group hover:rotate-0 transition-transform duration-500">
            <span className="text-black font-black text-xs -rotate-45 group-hover:rotate-0 transition-transform">LB</span>
          </div>
          <div className="flex flex-col">
            LYBA
            <span className="text-[8px] tracking-[0.4em] uppercase text-white/40 leading-none">Groupe d'entreprises</span>
          </div>
        </div>

        <div className="hidden lg:flex items-center gap-10">
          {['Expertise', 'Airtel Connect', 'Solutions'].map(link => (
            <button key={link} className="text-[10px] uppercase tracking-[0.2em] font-semibold text-white/60 hover:text-[#D4AF37] transition-colors">{link}</button>
          ))}
          <div className="h-4 w-px bg-white/10"></div>
          <button onClick={() => setShowAdmin(!showAdmin)} className="text-white/30 hover:text-[#D4AF37] transition-colors">
            <LayoutDashboard taille={18} />
          </button>
          <a href={`tel:${contactData.phones[0]}`} className="bg-[#D4AF37] text-black px-6 py-2.5 rounded-full text-[10px] font-black uppercase tracking-widest hover:bg-white transition-all">
            Nous contacter
          </a>
        </div>
      </nav>

      {showAdmin ? (
        /* ADMIN PROFESSIONNEL DU TABLEAU DE BORD */
        <section className="pt-32 px-6 lg:px-12 max-w-6xl mx-auto min-h-screen">
          {!isAdminAuthenticated ? (
            <div className="max-w-md mx-auto bg-[#0A0A0A] p-10 rounded-2xl border border-white/5 shadow-2xl">
              <div className="w-16 h-16 bg-[#D4AF37]/10 rounded-full flex items-center justify-center mx-auto mb-6">
                <Lock className="text-[#D4AF37]" size={24} />
              </div>
              <h2 className="text-center text-xl font-bold mb-8 tracking-widest uppercase">Administration de l'authentification</h2>
              <input
                type="mot de passe"
                placeholder="Code de sécurité"
                className="w-full bg-black border border-white/10 p-4 rounded-lg mb-6 text-center focus:border-[#D4AF37] transition-colors outline-none font-mono"
                onChange={(e) => setAdminPass(e.target.value)}
              />
              <button onClick={checkAdmin} className="w-full bg-white text-black py-4 rounded-lg font-bold uppercase tracking-widest text-xs hover:bg-[#D4AF37] transition-colors">Entrer</button>
            </div>
          ) : (
            <div className="animate-in fade-in duration-700">
              <div className="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
                <h2 className="text-3xl font-light tracking-tighter italic">Gestionnaire de <span className="text-[#D4AF37]">Flux Clients</span></h2>
                <button onClick={() => {setIsAdminAuthenticated(false); setShowAdmin(false);}} className="text-[10px] uppercase tracking-widest border border-white/10 px-6 py-2 rounded-full hover:bg-white/5 transition-all">Quitter le panneau</button>
              </div>
              
              <div className="overflow-hidden border border-white/5 rounded-2xl bg-[#0A0A0A]">
                <table className="w-full text-left border-collapse">
                  <thead className="bg-white/5 text-[10px] uppercase tracking-widest text-white/40">
                    <tr>
                      <th className="p-6">Client</th>
                      <th className="p-6">Forfait</th>
                      <th className="p-6">Date</th>
                      <th className="p-6">Action</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-white/5">
                    {orders.map(o => (
                      <tr key={o.id} className="hover:bg-white/[0.02] transition-colors">
                        <td className="p-6">
                          <p className="font-bold">{o.client}</p>
                          <p className="text-xs text-[#D4AF37]">{o.contact}</p>
                        </td>
                        <td className="p-6 italic text-sm">{o.forfait} (${o.montant})</td>
                        <td className="p-6 text-xs text-white/40">
                          {o.date?.seconds ? new Date(o.date.seconds * 1000).toLocaleDateString() : 'En attente...'}
                        </td>
                        <td className="p-6">
                          <a href={`tel:${o.contact}`} className="text-[#D4AF37] hover:underline text-xs flex items-center gap-1">
                            Appeleur <ArrowUpRight size={12} />
                          </a>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
          )}
        </section>
      ) : (
        <>
          {/* SECTION HÉROS ULTRA-MODERNE */}
          <section className="relative pt-48 pb-32 px-6 overflow-hidden">
            <div className="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[600px] bg-[#D4AF37]/5 blur-[120px] rounded-full pointer-events-none"></div>
            <div className="max-w-6xl mx-auto text-center relative z-10">
              <div className="inline-flex items-center gap-3 px-6 py-2 rounded-full border border-white/10 bg-white/5 text-[10px] font-bold uppercase tracking-[0.3em] mb-12 animate-in slide-in-from-bottom duration-1000">
                <Cpu className="w-3 h-3 text-[#D4AF37]" /> Partenariat Stratégique Airtel
              </div>
              <h1 className="text-6xl md:text-9xl font-black mb-8 tracking-tighter leading-none italic uppercase">
                Connectivité <br /> <span className="text-[#D4AF37]">Privilège</span>
              </h1>
              <p className="text-lg md:text-xl text-white/50 max-w-3xl mx-auto mb-16 leading-relaxed font-light">
                Redéfinissez la performance de votre entreprise. Bénéficiez de notre infrastructure réseau haut de gamme à 4 récepteurs. **Équipement Offert**.
              </p>
              <div className="flex flex-col sm:flex-row gap-6 justify-center items-center">
                <button onClick={() => document.getElementById('catalogue').scrollIntoView({behavior:'smooth'})} className="group bg-white text-black px-12 py-5 rounded-full font-black uppercase tracking-widest text-xs flex items-center gap-3 hover:bg-[#D4AF37] transition-all duration-500">
                  Découvrez les offres <ChevronRight size={16} className="group-hover:translate-x-2 transition-transform" />
                </button>
                <div className="flex items-center gap-4 text-white/40 font-bold uppercase text-[10px] tracking-widest">
                  Garantie Airtel & LYBA
                </div>
              </div>
            </div>
          </section>

          {/* SPÉCIFICATIONS TECHNIQUES LUXE */}
          <section className="py-24 border-y border-white/5 bg-[#080808]">
            <div className="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-20">
              {[
                { icône : <Wifi />, titre : "Antennes Quad-Link", desc : "4 récepteurs à haute sensibilité pour une pénétration optimale du signal." },
                { icon: <Utilisateurs />, title: "32 Canaux Actifs", desc: "Multi-threading permettant jusqu'à 32 sessions simultanées sans perte de débit." },
                { icon: <Globe />, title: "Rayon de 100M", desc: "Couverture hémisphérique étendue pour les bureaux de grande surface." }
              ].map((spec, i) => (
                <div key={i} className="flex flex-col items-center text-center group">
                  <div className="w-16 h-16 bg-white/5 rounded-2xl flex items-center justify-center text-[#D4AF37] mb-8 group-hover:bg-[#D4AF37] group-hover:text-black transition-all duration-500 transform group-hover:-translate-y-2">
                    {spec.icon}
                  </div>
                  <h3 className="text-lg font-bold mb-4 tracking-widest uppercase">{spec.title}</h3>
                  <p className="text-white/40 text-sm leading-relaxed">{spec.desc}</p>
                </div>
              ))}
            </div>
          </section>

          {/* CATALOGUE DES FORFAITS */}
          <section id="catalogue" className="py-32 px-6">
            <div className="max-w-7xl mx-auto">
              <div className="flex flex-col md:flex-row justify-between items-end mb-20 gap-8">
                <div className="max-w-xl">
                  <h2 className="text-[#D4AF37] font-bold text-xs uppercase tracking-[0.4em] mb-4">Abonnements Premium</h2>
                  <h3 className="text-4xl md:text-5xl font-light tracking-tighter italic uppercase">Vitesse & <span className="text-[#D4AF37]">Fiabilité</span></h3>
                </div>
                <p className="text-white/30 text-xs font-bold uppercase tracking-widest mb-2 border-l border-[#D4AF37] pl-4">Routeur Offert avec chaque plan</p>
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                {plans.map(p => (
                  <div key={p.id} className={`group relative p-12 rounded-[2.5rem] transition-all duration-700 ${p.popular ? 'bg-gradient-to-b from-white/10 to-transparent border border-[#D4AF37]/50' : 'bg-white/[0.02] border border-white/5'}`}>
                    <div className="mb-10">
                      <p className="text-white/40 font-black text-[10px] uppercase tracking-[0.3em] mb-2 italic">{p.label}</p>
                      <div className="flex items-baseline gap-2 font-black text-6xl tracking-tighter">
                        <span className="text-sm align-top mt-2">$</span>{p.price}
                      </div>
                    </div>
                    <p className="text-white/40 text-sm mb-10 h-12 leading-relaxed">{p.desc}</p>
                    <div className="bg-black/50 p-6 rounded-2xl mb-10 border border-white/5 group-hover:border-[#D4AF37]/30 transition-colors">
                      <p className="text-[10px] text-[#D4AF37] font-black uppercase mb-2 tracking-widest">Bande Passante</p>
                      <p className="text-4xl font-light italic">{p.speed}</p>
                    </div>
                    < bouton
                      onClick={() => {setSelectedPlan(p); document.getElementById('reservation').scrollIntoView({behavior:'smooth'})}}
                      className={`w-full py-5 rounded-full font-black uppercase tracking-widest text-[10px] transition-all duration-500 ${p.popular ? 'bg-[#D4AF37] text-black hover:bg-white' : 'bg-white/5 hover:bg-white hover:text-black'}`}
                    >
                      Choisir ce Forfait
                    </button>
                  </div>
                ))}
              </div>
            </div>
          </section>

          {/* RÉSERVATION LUXE */}
          <section id="reservation" className="py-32 px-6 relative bg-gradient-to-b from-[#080808] to-black">
            <div className="max-w-4xl mx-auto bg-[#0A0A0A] p-12 lg:p-20 rounded-[3rem] border border-white/5 shadow-3xl relative overflow-hidden">
              <div className="absolute top-0 right-0 p-12 opacity-5 pointer-events-none">
                <Wifi taille={240} />
              </div>
              <div className="relative z-10 text-center mb-16">
                <h3 className="text-3xl font-light tracking-tighter italic uppercase mb-4 italic">Formulaire de <span className="text-[#D4AF37]">Réservation</span></h3>
                <p className="text-white/40 text-sm font-light">Un conseiller haut de gamme LYBA traitera votre demande sous 2h.</p>
              </div>

              <form onSubmit={handleOrder} className="space-y-8 relative z-10">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                  <div className="space-y-2">
                    <label className="text-[10px] uppercase tracking-widest text-white/30 ml-4">Identité complète</label>
                    <input required name="name" className="w-full bg-black border border-white/10 rounded-full p-5 focus:border-[#D4AF37] outline-none transition-colors" />
                  </div>
                  <div className="space-y-2">
                    <label className="text-[10px] uppercase tracking-widest text-white/30 ml-4">Contactez-nous directement</label>
                    <input required name="phone" className="w-full bg-black border border-white/10 rounded-full p-5 focus:border-[#D4AF37] outline-none transition-colors" />
                  </div>
                </div>
                
                <div className="p-8 bg-white/5 rounded-3xl border border-white/5 flex justify-between items-center">
                  <div>
                    <p className="text-[10px] text-white/30 font-black uppercase tracking-widest mb-1">Offre Sélection</p>
                    <p className="text-2xl font-light italic text-[#D4AF37]">{selectedPlan ? selectedPlan.label : 'Forfait non défini'}</p>
                  </div>
                  {plan sélectionné && <p className="text-3xl font-black">${plan sélectionné.prix}</p>}
                </div>

                < bouton
                  désactivé={!plan sélectionné || statut du formulaire.type === 'chargement'}
                  className="w-full bg-white text-black disabled:opacity-20 font-black py-6 rounded-full uppercase tracking-[0.3em] text-xs hover:bg-[#D4AF37] transition-all duration-700 shadow-xl"
                >
                  {formStatus.type === 'chargement' ? 'Sécurisation...' : 'Valider la Demande de Routeur'}
                </button>
                
                {formStatus.message && (
                  <div className={`p-4 rounded-xl text-center text-xs font-bold tracking-widest animate-pulse ${formStatus.type === 'error' ? 'bg-red-500/10 text-red-500' : 'bg-green-500/10 text-green-500'}`}>
                    {formStatus.message}
                  </div>
                )}
              </form>
            </div>
          </section>
        </>
      )}

      {/* PIED DE PAGE D'ENTREPRISE */}
      <footer className="py-24 px-12 bg-black border-t border-white/5">
        <div className="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-16">
          <div className="space-y-6">
            <div className="flex items-center gap-3">
              <div className="h-8 w-8 bg-[#D4AF37] rounded-sm rotate-45 flex items-center justify-center">
                <span className="text-black font-bold text-[10px] -rotate-45">LB</span>
              </div>
              LYBA BUSINESS
            </div>
            <p className="text-white/30 text-xs leading-relaxed max-w-xs">
              L'excellence au service de vos projets. Leader en solutions de connectivité et conseil stratégique.
            </p>
          </div>
          
          <div className="space-y-6">
            <h4 className="text-[10px] uppercase tracking-[0.3em] font-black text-white/50">Assistance et contact</h4>
            <div className="space-y-4">
              <a href={`mailto:${contactData.email}`} className="flex items-center gap-3 text-xs text-white/60 hover:text-[#D4AF37]">
                <Mail size={14} /> {contactData.email}
              </a>
              <div className="flex flex-col gap-2 text-xs text-white/60">
                <span className="flex items-center gap-3"><Phone size={14} /> {contactData.phones[0]}</span>
                <span className="flex items-center gap-3"><Phone size={14} /> {contactData.phones[1]}</span>
              </div>
            </div>
          </div>

          <div className="space-y-6">
            <h4 className="text-[10px] uppercase tracking-[0.3em] font-black text-white/50">Partenariat</h4>
            <div className="flex items-center gap-4 grayscale opacity-40 hover:grayscale-0 hover:opacity-100 transition-all cursor-crosshair">
              <div className="bg-red-600 px-3 py-1 rounded text-[10px] font-black italic">airtel</div>
              <div className="text-[10px] font-black tracking-tighter">Partenaire commercial</div>
            </div>
          </div>
        </div>
        <div className="mt-20 pt-12 border-t border-white/5 text-center">
          <p className="text-[8px] tracking-[0.5em] text-white/20 uppercase">© 2024 LYBA BUSINESS GROUP - Tous droits réservés</p>
        </div>
      </footer>
    </div>
  );
};

exporter l'application par défaut ;
